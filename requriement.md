# 크롬 익스텐션 웹 페이지 요약기 명세서

## 프로젝트 개요

웹 페이지의 본문을 자동으로 추출하고 AI를 통해 요약하는 크롬 익스텐션 개발

## 핵심 기술 스택

- **Mozilla Readability**: 웹 페이지 본문 추출 (@mozilla/readability)
- **MLC-AI WebLLM**: 브라우저 내 LLM 추론 엔진 (@mlc-ai/web-llm)
- **Chrome Extension Manifest V3**: 사이드 패널 API 활용
- **Hugging Face Models**: MLC-AI 조직의 사전 컴파일된 모델 사용

## 1. 기능 명세 (Functional Requirements)

### 1.1 사이드 패널 UI

- **위치**: 브라우저 우측 사이드 패널
- **접근 방법**:
  - 익스텐션 아이콘 클릭으로 패널 열기/닫기
  - 패널은 모든 웹사이트에서 동일하게 표시
- **기본 크기**: 최소 320px 너비 (Chrome 기본값)

### 1.2 본문 추출 기능

- **버튼**: "본문 추출" 버튼
- **동작**:
  - 현재 활성 탭의 웹 페이지에서 Mozilla Readability를 사용하여 본문 추출
  - 추출된 본문을 사이드 패널에 표시
- **자동 정리**:
  - Readability가 자동으로 광고, 버튼, 배경 이미지, 네비게이션 메뉴 제거
  - 읽기에 적합한 텍스트 중심 콘텐츠만 추출
- **처리 가능 콘텐츠**:
  - 기사, 블로그 포스트, 뉴스 등 텍스트 중심 콘텐츠
  - 충분한 텍스트 길이가 있는 페이지 (Readability 기준)

### 1.3 AI 요약 기능

- **처리 방식**:
  - 추출된 본문을 LLM에 전달
  - 스트리밍 방식으로 요약 결과 실시간 표시
  - WebGPU 가속 활용

### 1.4 스트리밍 응답 표시 (⚠️ 취소 기능 제한사항)

- **실시간 출력**: 요약 텍스트를 점진적으로 표시
- **사용자 경험**:
  - 로딩 인디케이터 표시
  - 요약 진행 상황 시각화
- **안전한 중단 방법**:
  - UI에서 취소 요청 시 즉시 엔진 종료 (`currentEngine = null`)
  - 새로운 요약 요청 시 엔진 재생성
  - 사용자에게 취소 시 잠시 대기 필요함을 안내

### 1.5 GPU 자원 관리 (중요!)

- **메모리 모니터링**:
  - GPU 메모리 사용량 실시간 체크
  - "Device was lost" 에러 감지 및 복구
  - 메모리 부족 시 사용자 알림
- **자원 정리**:
  - 요약 완료 후 자동 메모리 정리
  - 취소 시 즉시 GPU 리소스 해제
- **안정성**:
  - 주기적 GPU 상태 체크
  - 오류 발생 시 자동 엔진 재시작

### 1.6 추가 UI 기능

- **상태 표시**:
  - 본문 추출 성공/실패 상태
  - LLM 로딩 상태
  - 모델 다운로드 진행률
  - **GPU 메모리 사용률 표시**
- **오류 처리**:
  - 본문 추출 실패 시 사용자 알림
  - LLM 추론 오류 시 재시도 옵션

### 2.3 보안 요구사항

- **Manifest V3**: 최신 보안 표준 준수
- **권한 최소화**:
  - `sidePanel` 권한
  - `activeTab` 권한 (현재 탭 접근)
  - `storage` 권한 (설정 저장)
- **컨텐츠 보안**:
  - 외부 스크립트 실행 금지
  - 샌드박스된 환경에서 LLM 실행

### 2.5 안정성 요구사항

- **오류 복구**: 네트워크 오류 시 자동 재시도
- **GPU 메모리 관리** (매우 중요!):
  - "Device was lost" 에러 감지 및 자동 복구
  - 메모리 누수 방지를 위한 주기적 정리
  - 큰 모델 사용 시 메모리 한계 모니터링
  - 다중 탭에서 동시 사용 방지 (리소스 충돌 방지)
- **서비스 워커**:
  - Manifest V3 서비스 워커 생명주기 관리
  - 백그라운드에서 GPU 상태 모니터링
- **자원 해제**:
  - 탭 닫기/새로고침 시 즉시 GPU 메모리 해제
  - 익스텐션 비활성화 시 모든 GPU 리소스 정리
  - 응답 취소 시 완전한 리소스 정리

## 4. 개발 우선순위

### Phase 1: 기본 구조

1. Manifest V3 익스텐션 기본 설정
2. 사이드 패널 UI 구현
3. Mozilla Readability 통합

### Phase 2: AI 통합 (⚠️ WebLLM 제약사항 고려)

1. WebLLM 설정 및 Gemma-3 4B 모델 통합
2. **GPU 메모리 관리 시스템 구현** (최우선순위)
3. **안전한 엔진 재시작 메커니즘** (취소 대응)
4. 모델 다운로드 진행률 표시
5. 한국어 요약에 최적화된 프롬프트 설계
6. 기본 요약 기능 구현

### Phase 3: UX 개선 및 안정성

1. 로딩 상태 및 진행률 표시
2. **GPU 메모리 사용률 표시**
3. **사용자 교육 UI** (취소 기능 한계 설명)
4. 오류 처리 및 사용자 피드백
5. **"Device was lost" 에러 복구 시스템**
6. 성능 최적화

### 6.2 프롬프트 최적화

```javascript
const SUMMARY_PROMPT_TEMPLATE = `다음 웹 기사를 3-5문장으로 간결하게 요약해주세요. 핵심 내용과 주요 포인트를 포함해야 합니다.

제목: {title}

기사 내용:
{content}

요약:`;
```

### 6.3 성능 최적화 및 자원 관리 팁

- **초기 로딩**: 첫 방문 시 모델 다운로드를 위한 대기시간 안내
- **캐싱**: 브라우저 캐시를 활용하여 재방문 시 빠른 로딩

### 6.4 사용자 경험 개선

- **모델 상태 표시**: 다운로드 중, 로딩 중, 준비 완료 상태 구분
- **오프라인 지원**: 모델 다운로드 후 네트워크 없이도 동작
- **에러 복구**: GPU 메모리 부족 시 재시도 로직
